# 仕様

このリバースプロキシの外部仕様を日本語でもまとめておく。

## リクエストのプロキシルール

現在

- `/api` で始まるURIをAPIサーバーに転送
- それ以外のすべてをWEBサーバーに転送

している。

## 内部アプリケーションに提供する機構

### セッション情報が付与されたリクエストヘッダー

内部のアプリケーションは `X-Auth` というリクエストヘッダーを取得できる。
これにはセッションに投入されている情報が格納されているので、自由に取得して良い。

`X-Auth` ヘッダーが付与されていないリクエストは未ログインユーザーからのリクエストである。

### `X-Auth` ヘッダーの内容

```
{:k "セッションID"
 :v "セッション"}
```

### レスポンスヘッダーから得た情報によってセッションを作成・更新・破棄

もし内部アプリケーションが `X-Auth` レスポンスヘッダーを付与しない場合、リバースプロキシは何もしない。

もし `X-Auth` ヘッダーにvのみを指定した場合、新たなセッションを生成する。

もし `X-Auth` ヘッダーにkのみを指定した場合、セッションを破棄する。
